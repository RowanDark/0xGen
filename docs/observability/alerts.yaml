groups:
  - name: 0xgen-observability
    rules:
      - alert: 0xgenPluginLatencyCritical
        expr: histogram_quantile(0.95, sum(rate(oxg_plugin_event_duration_seconds_bucket[5m])) by (le, plugin)) > 5
        for: 3m
        labels:
          severity: critical
        annotations:
          summary: "Plugin {{ $labels.plugin }} processing is slow"
          description: |
            0xgen has spent more than 5 seconds (p95) handling plugin events for
            {{ $labels.plugin }} during the last 5 minutes. Investigate plugin logs and traces
            for long-running EventStream handlers.
      - alert: 0xgenHTTPFailureRate
        expr: sum(rate(oxg_http_backoff_total[5m])) by (plugin) / sum(rate(oxg_http_request_duration_seconds_count[5m])) by (plugin) > 0.2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High HTTP error rate for plugin {{ $labels.plugin }}"
          description: |
            More than 20% of proxied HTTP requests for {{ $labels.plugin }} have resulted
            in backoff-triggering responses during the last 5 minutes.
      - alert: 0xgenQueueBackpressure
        expr: max_over_time(oxg_plugin_queue_length[2m]) > 80
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Plugin queue saturation"
          description: |
            The plugin outbound queue has exceeded 80 entries for more than two minutes,
            indicating downstream pressure. Review queue depth and dispatch traces.
